# api + redis persistent
import time
import redis
from utils.get_orderbook import get_orderbook


#a = {'lastUpdateId': 28170469505, 'bids': [[16547.7, 0.08153], [16547.69, 0.06595], [16547.68, 0.0054], [16547.66, 0.06647], [16547.57, 0.02204], [16547.56, 0.0186], [16547.55, 0.09144], [16547.54, 0.00347], [16547.52, 0.01039], [16547.44, 0.006], [16547.36, 0.00519], [16547.35, 0.093], [16547.34, 0.22442], [16547.33, 0.03], [16547.31, 0.00212], [16547.28, 0.0937], [16547.23, 0.0651], [16547.22, 0.76549], [16547.21, 0.00649], [16547.17, 0.04161], [16547.01, 0.01203], [16547.0, 0.00198], [16546.99, 0.1755], [16546.98, 0.11285], [16546.97, 0.4245], [16546.96, 0.1768], [16546.95, 0.1526], [16546.87, 0.00458], [16546.85, 0.00658], [16546.75, 0.00657], [16546.74, 0.00141], [16546.64, 0.00638], [16546.61, 0.00362], [16546.59, 0.04], [16546.56, 0.09299], [16546.55, 0.20412], [16546.53, 0.00212], [16546.48, 0.22523], [16546.45, 0.05402], [16546.44, 0.55582], [16546.43, 0.55391], [16546.4, 0.02479], [16546.37, 0.00607], [16546.36, 0.01971], [16546.32, 0.37193], [16546.31, 0.05], [16546.29, 0.07316], [16546.27, 0.01096], [16546.26, 0.01447], [16546.24, 0.06006], [16546.23, 0.00598], [16546.21, 0.01999], [16546.16, 0.2431], [16546.09, 0.19892], [16546.08, 0.0862], [16546.05, 0.22411], [16546.04, 0.06048], [16546.0, 0.05296], [16545.98, 0.1431], [16545.97, 0.36262], [16545.94, 0.1431], [16545.93, 0.04244], [16545.89, 0.01853], [16545.88, 0.01052], [16545.85, 0.0431], [16545.77, 0.56005], [16545.76, 0.03942], [16545.75, 0.06043], [16545.72, 0.05], [16545.71, 0.0438], [16545.58, 0.00649], [16545.52, 0.04532], [16545.47, 0.00711], [16545.45, 0.02], [16545.39, 0.06394], [16545.2, 0.18602], [16545.19, 0.3498], [16545.15, 0.37198], [16545.13, 0.005], [16545.1, 0.02], [16545.09, 0.02018], [16545.06, 0.00331], [16545.01, 0.00063], [16545.0, 0.01148], [16544.97, 0.1449], [16544.91, 0.01819], [16544.78, 0.34736], [16544.77, 0.07419], [16544.69, 0.00092], [16544.68, 0.11835], [16544.67, 0.5717], [16544.62, 0.79455], [16544.59, 0.03567], [16544.51, 0.1], [16544.5, 0.006], [16544.49, 0.37666], [16544.47, 0.08481], [16544.44, 0.34893], [16544.37, 0.12192], [16544.36, 0.1], [16544.32, 0.44885], [16544.31, 0.7334], [16544.26, 0.65589], [16544.25, 0.97817], [16544.22, 0.14485], [16544.18, 1.63966], [16544.15, 0.0219], [16544.12, 0.00651], [16544.09, 0.005], [16544.0, 0.95181], [16543.99, 0.001], [16543.97, 0.1], [16543.79, 0.03022], [16543.74, 0.005], [16543.69, 0.93743], [16543.68, 0.05], [16543.65, 0.0301], [16543.61, 0.28452], [16543.56, 0.0299], [16543.55, 0.0561], [16543.52, 0.05], [16543.51, 0.01971], [16543.5, 0.00109], [16543.46, 0.0036], [16543.43, 1.00005], [16543.42, 0.72427], [16543.39, 0.43333], [16543.38, 2.5], [16543.35, 0.006], [16543.31, 0.48373], [16543.3, 0.2], [16543.28, 0.01573], [16543.26, 0.13486], [16543.24, 0.00198], [16543.2, 0.0155], [16543.17, 0.27056], [16543.14, 0.72564], [16543.03, 0.05], [16543.0, 1.0], [16542.99, 0.31577], [16542.97, 0.14687], [16542.92, 0.43], [16542.91, 0.0125], [16542.84, 0.47607], [16542.79, 0.03942], [16542.75, 0.56784], [16542.7, 0.006], [16542.63, 0.11287], [16542.59, 0.1], [16542.49, 0.34787], [16542.48, 0.00213], [16542.43, 0.72427], [16542.3, 0.00774], [16542.25, 0.05], [16542.23, 6.74308], [16542.22, 4.38654], [16542.2, 0.00301], [16542.12, 0.91548], [16542.11, 0.02782], [16542.09, 0.48], [16542.07, 0.33], [16542.05, 0.01196], [16542.04, 0.00752], [16542.0, 1.00296], [16541.98, 0.66248], [16541.93, 16.40513], [16541.92, 0.0081], [16541.9, 3.95841], [16541.83, 0.05], [16541.82, 0.00198], [16541.8, 0.2722], [16541.76, 0.00331], [16541.73, 0.2947], [16541.66, 0.00666], [16541.64, 0.04359], [16541.48, 0.02451], [16541.47, 0.02511], [16541.46, 0.05], [16541.44, 1.09302], [16541.42, 0.00118], [16541.41, 0.94114], [16541.34, 0.25954], [16541.33, 0.00104], [16541.3, 0.0015], [16541.29, 1.20175], [16541.27, 0.05], [16541.26, 2.73253], [16541.23, 0.01196], [16541.22, 0.39152], [16541.21, 0.77242], [16541.19, 0.53648], [16541.13, 0.28], [16541.12, 0.60492], [16541.11, 0.005], [16541.08, 0.03122], [16541.02, 0.00198], [16541.01, 0.11834], [16541.0, 0.25037], [16540.99, 0.00483], [16540.93, 0.00374]], 'asks': [[16548.54, 0.05], [16548.55, 0.07513], [16548.57, 0.001], [16548.58, 0.00531], [16548.64, 0.02], [16548.71, 0.02], [16548.74, 0.02], [16548.78, 0.00164], [16548.82, 0.00061], [16549.07, 0.00414], [16549.08, 0.00274], [16549.12, 0.00636], [16549.18, 0.04302], [16549.21, 0.00507], [16549.24, 0.0431], [16549.25, 0.0054], [16549.35, 0.0054], [16549.36, 0.02305], [16549.37, 0.0431], [16549.38, 0.00066], [16549.39, 0.09064], [16549.41, 0.005], [16549.54, 0.00693], [16549.63, 0.01284], [16549.64, 0.01801], [16549.65, 0.25544], [16549.66, 0.44444], [16549.67, 0.2155], [16549.82, 0.0725], [16549.84, 0.3952], [16549.85, 0.1772], [16549.86, 0.1869], [16549.9, 0.0438], [16549.91, 0.00392], [16550.0, 0.00296], [16550.12, 0.1], [16550.13, 0.06043], [16550.15, 0.01511], [16550.27, 0.006], [16550.3, 0.00376], [16550.31, 0.01971], [16550.4, 0.04161], [16550.44, 0.006], [16550.46, 0.006], [16550.47, 0.00824], [16550.49, 0.006], [16550.53, 0.001], [16550.55, 0.03054], [16550.56, 0.04817], [16550.57, 0.03696], [16550.59, 0.006], [16550.61, 0.25925], [16550.62, 0.012], [16550.66, 0.01861], [16550.67, 0.03289], [16550.71, 0.2163], [16550.73, 0.2123], [16550.75, 0.0063], [16550.77, 0.12328], [16550.86, 0.05655], [16550.89, 0.01893], [16550.92, 0.03028], [16550.95, 0.00691], [16550.99, 0.15809], [16551.0, 0.46832], [16551.03, 0.07205], [16551.15, 0.04532], [16551.16, 0.00455], [16551.18, 0.006], [16551.19, 0.00066], [16551.2, 0.006], [16551.27, 0.03249], [16551.28, 0.006], [16551.31, 0.012], [16551.35, 0.06043], [16551.44, 0.00566], [16551.45, 0.0388], [16551.46, 0.07532], [16551.47, 0.006], [16551.5, 0.06043], [16551.52, 0.12215], [16551.53, 0.06043], [16551.61, 0.00152], [16551.66, 0.04], [16551.67, 0.006], [16551.72, 0.006], [16551.75, 0.00078], [16551.76, 0.20792], [16551.77, 0.04161], [16551.83, 0.00077], [16551.84, 0.09299], [16551.85, 0.30516], [16551.92, 0.00063], [16551.94, 0.20038], [16551.95, 0.002], [16551.96, 0.03549], [16552.0, 0.04802], [16552.03, 0.0014], [16552.06, 0.00167], [16552.07, 0.00473], [16552.11, 0.2], [16552.12, 0.0058], [16552.16, 0.00657], [16552.18, 0.01], [16552.24, 0.01316], [16552.25, 0.12007], [16552.26, 0.052], [16552.27, 0.06006], [16552.28, 0.07543], [16552.41, 0.01819], [16552.43, 0.01316], [16552.46, 0.0299], [16552.5, 0.01315], [16552.54, 0.00302], [16552.57, 0.24517], [16552.59, 0.61287], [16552.61, 0.0186], [16552.62, 0.03214], [16552.74, 0.2], [16552.79, 0.0075], [16552.81, 0.01853], [16552.82, 0.02148], [16552.87, 0.00212], [16552.91, 0.03], [16552.93, 0.93524], [16552.94, 0.72427], [16552.95, 0.05], [16552.97, 0.00078], [16552.99, 0.45413], [16553.0, 0.0007], [16553.01, 0.00655], [16553.03, 0.07181], [16553.05, 0.00089], [16553.16, 0.15175], [16553.18, 0.28669], [16553.19, 1.1921], [16553.24, 2.32804], [16553.29, 0.005], [16553.43, 0.6054], [16553.57, 0.05], [16553.61, 0.002], [16553.62, 0.4837], [16553.7, 0.12606], [16553.73, 0.53671], [16553.76, 0.89652], [16553.79, 0.07681], [16553.8, 0.00212], [16553.82, 0.41465], [16553.83, 1.02346], [16553.85, 0.04], [16553.95, 0.938], [16554.0, 0.08355], [16554.09, 0.00198], [16554.11, 0.005], [16554.12, 0.181], [16554.13, 0.14485], [16554.14, 0.52976], [16554.15, 0.05], [16554.17, 0.25087], [16554.19, 0.43543], [16554.2, 0.00302], [16554.23, 0.05487], [16554.25, 0.22875], [16554.26, 0.77966], [16554.27, 0.00253], [16554.28, 0.02064], [16554.36, 0.34832], [16554.37, 6.296], [16554.38, 0.00078], [16554.39, 0.00118], [16554.4, 0.05], [16554.44, 0.88], [16554.48, 0.37045], [16554.49, 0.04], [16554.58, 15.73999], [16554.59, 0.0315], [16554.7, 0.125], [16554.71, 0.00631], [16554.74, 0.02894], [16554.81, 0.15397], [16554.85, 0.00696], [16554.88, 0.02358], [16554.96, 0.0301], [16554.97, 0.05], [16554.98, 0.00331], [16554.99, 0.27629], [16555.0, 0.02464], [16555.03, 0.14365], [16555.04, 0.00212], [16555.05, 0.001], [16555.06, 0.04], [16555.07, 0.07583], [16555.12, 0.005], [16555.18, 0.36806], [16555.19, 0.32], [16555.2, 0.14495], [16555.21, 0.2], [16555.22, 0.2], [16555.23, 0.00326], [16555.28, 0.0075]]}
#orderbook = {"28170469505": "'bids' : [[16547.7, 0.08153]'"}

if __name__ == "__main__":
    conn = redis.Redis('localhost')
    while True:
        orderbook = get_orderbook('BTCUSDT')
        print(orderbook)
        print(type(orderbook))
        data = dict(orderbook)
        #d.append(data)
        conn.mset(data)
        print(conn.keys())